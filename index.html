<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Legal Letter Generation System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Crimson+Pro:wght@400;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <script>
        // ===== GLOBAL STATE =====
        let clients = [];
        let currentClient = null;
        let currentCDRData = null;
        let courtCalendarData = [];
        let currentWeekNumber = null;

        // ===== UTILITIES =====
        const formatDate = (dateString) => {
            if (!dateString) return '';
            return new Date(dateString).toLocaleDateString('en-AU', {
                day: 'numeric', month: 'long', year: 'numeric'
            });
        };

        const getTodayDate = () => new Date().toISOString().split('T')[0];

        const getTemplateFileName = (type) => ({
            'CCL': 'CCL_Template.docx',
            'Mention': 'Mention_Template.docx',
            'Final': 'Final_Template.docx',
            'FeeReestimate': 'FeeReestimate_Template.docx'
        }[type] || 'Template.docx');

        // ===== DATA MANAGEMENT =====
        const saveData = () => {
            try {
                if (typeof(Storage) !== "undefined") {
                    localStorage.setItem('legalClients', JSON.stringify(clients));
                }
            } catch(e) {
                console.log('Storage not available');
            }
        };

        const loadSavedData = () => {
            try {
                if (typeof(Storage) !== "undefined") {
                    const saved = localStorage.getItem('legalClients');
                    if (saved) {
                        clients = JSON.parse(saved);
                        updateDatabaseStatus(true);
                    }
                }
            } catch(e) {
                console.log('Storage not available');
            }
        };

        // ===== UI UPDATES =====
        const updateDatabaseStatus = (connected) => {
            const status = document.getElementById('databaseStatus');
            if (status) {
                status.textContent = connected ?
                    `Database: Connected (${clients.length} clients)` :
                    'Database: Not Connected';
                status.className = `database-status status-${connected ? 'connected' : 'disconnected'}`;
            }
        };

        const updateUI = () => {
            loadClientTable();
            loadClientSelect();
            loadCDRClientSelect();
            loadFileNoteClientSelect();
            updateAnalytics();
        };

        const loadClientTable = () => {
            const tbody = document.getElementById('clientTableBody');
            const cardsContainer = document.getElementById('clientCardsContainer');

            if (!tbody && !cardsContainer) return;

            // Desktop table view
            if (tbody) {
                tbody.innerHTML = clients.length === 0 ?
                    `<tr><td colspan="10" style="text-align: center; padding: 40px; color: #6b7280;">
                        No clients loaded. Please upload an Excel database or add clients manually.
                    </td></tr>` :
                    clients.map(client => `
                        <tr>
                            <td><strong>${client.name}</strong></td>
                            <td>${client.matterNumber}</td>
                            <td>${client.court}</td>
                            <td>${client.charges}</td>
                            <td><span class="status-badge status-${client.status.toLowerCase()}">${client.status}</span></td>
                            <td>${client.ccl ? '✅' : '❌'}</td>
                            <td>${client.mention ? '✅' : '❌'}</td>
                            <td>${client.final ? '✅' : '❌'}</td>
                            <td>${client.nextCourt ? formatDate(client.nextCourt) : 'TBD'}</td>
                            <td><button class="btn btn-primary" style="padding: 6px 12px; font-size: 12px;"
                                onclick="selectClientForLetter(${client.id})">Generate Letter</button></td>
                        </tr>
                    `).join('');
            }

            // Mobile cards view
            if (cardsContainer) {
                if (clients.length === 0) {
                    cardsContainer.innerHTML = `<div style="text-align: center; padding: 40px; color: #6b7280;">
                        No clients loaded. Please upload an Excel database or add clients manually.
                    </div>`;
                } else {
                    cardsContainer.innerHTML =
                    clients.map(client => `
                        <div class="client-card" onclick="toggleClientCard(this)">
                            <div class="client-card-header">
                                <div class="client-card-main">
                                    <div class="client-card-name">${client.name}</div>
                                    <div class="client-card-matter">${client.matterNumber}</div>
                                    <div class="client-card-status-row">
                                        <span class="status-badge status-${client.status.toLowerCase()}">${client.status}</span>
                                    </div>
                                </div>
                                <div class="client-card-expand">▼</div>
                            </div>
                            <div class="client-card-details">
                                <div class="client-card-row">
                                    <span class="client-card-label">Court</span>
                                    <span class="client-card-value">${client.court || 'Not specified'}</span>
                                </div>
                                <div class="client-card-charges">
                                    <strong>Charges:</strong> ${client.charges || 'No charges listed'}
                                </div>
                                <div class="client-card-letters">
                                    <strong>Letter Status:</strong>
                                    <div class="client-card-letter-status">
                                        <span>CCL ${client.ccl ? '✅' : '❌'}</span>
                                        <span>Mention ${client.mention ? '✅' : '❌'}</span>
                                        <span>Final ${client.final ? '✅' : '❌'}</span>
                                    </div>
                                </div>
                                <div class="client-card-row">
                                    <span class="client-card-label">Next Court</span>
                                    <span class="client-card-value">${client.nextCourt ? formatDate(client.nextCourt) : 'TBD'}</span>
                                </div>
                                <div class="client-card-actions">
                                    <button class="client-card-btn" onclick="event.stopPropagation(); selectClientForLetter(${client.id})">
                                        Generate Letter
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }
            }
        };

        const loadClientSelect = () => {
            const select = document.getElementById('clientSelect');
            if (!select) return;
            select.innerHTML = '<option value="">-- Select a Client --</option>' +
                clients.map(c => `<option value="${c.id}">${c.name} (${c.matterNumber})</option>`).join('');
        };

        const loadCDRClientSelect = () => {
            const select = document.getElementById('cdrClientSelect');
            if (!select) return;
            select.innerHTML = '<option value="">-- Manual Entry --</option>' +
                clients.map(c => `<option value="${c.id}">${c.name} (${c.matterNumber})</option>`).join('');
        };

        const loadFileNoteClientSelect = () => {
            const select = document.getElementById('fileNoteClientSelect');
            if (!select) return;
            select.innerHTML = '<option value="">-- Select a Client --</option>' +
                clients.map(c => `<option value="${c.id}">${c.name} (${c.matterNumber})</option>`).join('');
        };

        const updateAnalytics = () => {
            const els = {
                totalMatters: document.getElementById('totalMatters'),
                activeMatters: document.getElementById('activeMatters'),
                pendingLetters: document.getElementById('pendingLetters'),
                upcomingCourt: document.getElementById('upcomingCourt')
            };

            if (els.totalMatters) els.totalMatters.textContent = clients.length;
            if (els.activeMatters) els.activeMatters.textContent = clients.filter(c => c.status === 'Active').length;
            if (els.pendingLetters) els.pendingLetters.textContent = clients.filter(c => !c.ccl).length;

            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            const upcoming = clients.filter(c => {
                if (!c.nextCourt) return false;
                const courtDate = new Date(c.nextCourt);
                return courtDate <= nextWeek && courtDate >= new Date();
            }).length;
            if (els.upcomingCourt) els.upcomingCourt.textContent = upcoming;

            // Court breakdown
            const courtBreakdown = {};
            clients.forEach(c => courtBreakdown[c.court] = (courtBreakdown[c.court] || 0) + 1);

            const courtDiv = document.getElementById('courtBreakdown');
            if (courtDiv) {
                courtDiv.innerHTML = Object.entries(courtBreakdown)
                    .sort((a, b) => b[1] - a[1])
                    .map(([court, count]) => `
                        <div class="court-breakdown-item">
                            <span class="court-name">${court}</span>
                            <span class="court-count">${count}</span>
                        </div>
                    `).join('') || '<p class="no-data">No data available</p>';
            }

            // Letter status
            const statusDiv = document.getElementById('letterStatusChart');
            if (statusDiv) {
                const stats = {
                    ccl: clients.filter(c => c.ccl).length,
                    mention: clients.filter(c => c.mention).length,
                    final: clients.filter(c => c.final).length
                };

                statusDiv.innerHTML = `
                    <div class="letter-status-grid">
                        <div class="status-card">
                            <div class="status-number">${stats.ccl}</div>
                            <div class="status-label">CCL Sent</div>
                        </div>
                        <div class="status-card">
                            <div class="status-number">${stats.mention}</div>
                            <div class="status-label">Mention Letters</div>
                        </div>
                        <div class="status-card">
                            <div class="status-number">${stats.final}</div>
                            <div class="status-label">Final Letters</div>
                        </div>
                    </div>`;
            }
        };

        // ===== NAVIGATION =====
        const switchTab = (tabName, event) => {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));

            const tabElement = document.getElementById(tabName);
            if (tabElement) tabElement.classList.add('active');
            if (event?.target) event.target.classList.add('active');

            if (tabName === 'analytics') updateAnalytics();
            if (tabName === 'calendar') updateCourtCalendar();
        };

        // ===== MODAL MANAGEMENT =====
        const openModal = () => document.getElementById('addClientModal').style.display = 'block';
        const closeModal = () => {
            document.getElementById('addClientModal').style.display = 'none';
            document.getElementById('addClientForm').reset();
        };

        // ===== CLIENT MANAGEMENT =====
        const addClient = (event) => {
            event.preventDefault();

            const newClient = {
                id: clients.length > 0 ? Math.max(...clients.map(c => c.id)) + 1 : 1,
                name: document.getElementById('newClientName').value,
                address: document.getElementById('newClientAddress').value,
                matterNumber: document.getElementById('newMatterNumber').value,
                court: document.getElementById('newCourt').value,
                matterType: document.getElementById('newMatterType').value,
                charges: document.getElementById('newCharges').value,
                legalAid: document.getElementById('newLegalAid').value === 'Yes',
                nextCourt: document.getElementById('newNextCourt').value,
                status: 'Active',
                ccl: false,
                mention: false,
                final: false,
                letterHistory: []
            };

            clients.push(newClient);
            saveData();
            updateUI();
            closeModal();
            alert('Client added successfully!');
        };

        const selectClientForLetter = (clientId) => {
            document.querySelector('.tab:nth-child(2)')?.click();
            document.getElementById('clientSelect').value = clientId;
            loadClientInfo();
        };

        // ===== CDR FUNCTIONS =====
        const loadCDRClientInfo = () => {
            const clientId = parseInt(document.getElementById('cdrClientSelect').value);
            const fields = ['cdrClientName', 'cdrFileNumber', 'cdrCourt', 'cdrOutcomeCourt'];

            if (!clientId) {
                fields.forEach(f => document.getElementById(f).value = '');
                return;
            }

            const client = clients.find(c => c.id === clientId);
            if (!client) return;

            document.getElementById('cdrClientName').value = client.name;
            document.getElementById('cdrFileNumber').value = client.matterNumber;
            document.getElementById('cdrCourt').value = client.court;
            document.getElementById('cdrOutcomeCourt').value = client.court;

            if (client.nextCourt) {
                document.getElementById('cdrCourtDate').value = client.nextCourt;
            }
        };

        const getAllocatedTo = () => {
            const allocated = [];
            document.querySelectorAll('input[id^="allocate_"]:checked').forEach(cb => allocated.push(cb.value));
            return allocated.join(', ') || 'TBD';
        };

        const getLetterAllocatedTo = () => {
            const allocated = [];
            document.querySelectorAll('input[id^="letter_allocate_"]:checked').forEach(cb => allocated.push(cb.value));
            return allocated.join(', ') || 'TBD';
        };

        const formatCDRText = (data) => {
            return `** ** ** ** **COURT OUTCOME** ** ** **
COURT: ${data.outcomeCourt}
DATE: ${formatDate(data.outcomeDate)}
CORAM:
CROWN:
START: ${data.startTime}
FINISH: ${data.finishTime}

**COURT DIARY REQUEST**
COURT DATE: ${formatDate(data.courtDate)}
SOLICITOR: ${data.solicitor}
CLIENT: ${data.clientName}
FILE NUMBER: ${data.fileNumber}
REASON: ${data.reason}
COURT: ${data.court}
COURT TIME: ${data.courtTime}
ALLOCATE TO: ${data.allocateTo}
CLIENT EXCUSED: ${data.clientExcused ? 'Yes' : 'No'}
FEE REMINDER: ${data.feeReminder || 'N/A'}${data.additionalDates ? '\n\nADDITIONAL DATES:\n' + data.additionalDates : ''}`;
        };

        const formatCDRHTML = (data) => {
            const row = (label, value) => `
                <tr>
                    <td style="width: 30%; padding: 5px 10px; font-weight: bold;">${label}:</td>
                    <td style="width: 70%; padding: 5px 10px;">${value || ''}</td>
                </tr>`;

            return `
            <div style="font-family: Arial, sans-serif; font-size: 10pt; color: black;">
                <p style="text-align: center; font-weight: bold; margin: 20px 0;">COURT OUTCOME</p>
                <table style="border-collapse: collapse; width: 100%; max-width: 650px;">
                    ${row('COURT', data.outcomeCourt)}
                    ${row('DATE', formatDate(data.outcomeDate))}
                    ${row('CORAM', '')}
                    ${row('CROWN', '')}
                    ${row('START', data.startTime)}
                    ${row('FINISH', data.finishTime)}
                </table>

                <p style="text-align: center; font-weight: bold; margin: 20px 0;">COURT DIARY REQUEST</p>
                <table style="border-collapse: collapse; width: 100%; max-width: 650px;">
                    ${row('COURT DATE', formatDate(data.courtDate))}
                    ${row('SOLICITOR', data.solicitor)}
                    ${row('CLIENT', data.clientName)}
                    ${row('FILE NUMBER', data.fileNumber)}
                    ${row('REASON', data.reason)}
                    ${row('COURT', data.court)}
                    ${row('COURT TIME', data.courtTime)}
                    ${row('ALLOCATE TO', data.allocateTo)}
                    ${row('CLIENT EXCUSED', data.clientExcused ? 'Yes' : 'No')}
                    ${row('FEE REMINDER', data.feeReminder)}
                    ${data.additionalDates ? row('ADDITIONAL DATES', data.additionalDates) : ''}
                </table>
            </div>`;
        };

        const generateCDR = () => {
            const cdrData = {
                outcomeCourt: document.getElementById('cdrOutcomeCourt').value,
                outcomeDate: document.getElementById('cdrOutcomeDate').value,
                startTime: document.getElementById('cdrStartTime').value,
                finishTime: document.getElementById('cdrFinishTime').value,
                courtDate: document.getElementById('cdrCourtDate').value,
                solicitor: document.getElementById('cdrSolicitor').value,
                clientName: document.getElementById('cdrClientName').value,
                fileNumber: document.getElementById('cdrFileNumber').value,
                reason: document.getElementById('cdrReason').value,
                court: document.getElementById('cdrCourt').value,
                courtTime: document.getElementById('cdrCourtTime').value,
                allocateTo: getAllocatedTo(),
                clientExcused: document.getElementById('cdrClientExcused').checked,
                feeReminder: document.getElementById('cdrFeeReminder').value,
                additionalDates: document.getElementById('cdrAdditionalDates')?.value || ''
            };

            currentCDRData = cdrData;
            const outputDiv = document.getElementById('cdrOutput');
            outputDiv.textContent = formatCDRText(cdrData);
            outputDiv.style.display = 'block';
        };

        const sendToZapier = (isCDROnly = false) => {
            const statusDiv = document.getElementById(isCDROnly ? 'cdrZapierStatus' : 'zapierStatus');

            if (isCDROnly && !currentCDRData) {
                alert('Please generate a CDR first');
                return;
            }

            if (!isCDROnly) {
                const promptText = document.getElementById('promptOutput').textContent;
                const letterType = document.getElementById('letterType').value;

                if (!promptText || !currentClient || !letterType) {
                    alert('Please generate a prompt first');
                    return;
                }
            }

            statusDiv.style.display = 'block';
            statusDiv.style.backgroundColor = '#fef3c7';
            statusDiv.style.color = '#92400e';
            statusDiv.textContent = 'Sending to Zapier...';

            const hasCDR = isCDROnly || document.getElementById('generateCDRWithLetter')?.checked;

            // Format today's date as "day month year" with month written out
            const today = new Date();
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            const formattedDate = `${today.getDate()} ${monthNames[today.getMonth()]} ${today.getFullYear()}`;

            // Get selected prefix
            const clientPrefix = document.getElementById('clientPrefix')?.value || '';

            const payload = {
                type: isCDROnly ? 'CDR_ONLY' : (hasCDR ? 'LETTER_AND_CDR' : document.getElementById('letterType').value),
                letterData: isCDROnly ? null : {
                    letterType: document.getElementById('letterType').value,
                    prompt: document.getElementById('promptOutput').textContent,
                    clientName: currentClient.name,
                    clientPrefix: clientPrefix,
                    letterDate: formattedDate,
                    matterNumber: currentClient.matterNumber,
                    court: currentClient.court,
                    templateFileName: getTemplateFileName(document.getElementById('letterType').value)
                },
                cdrData: null,
                hasLetter: !isCDROnly,
                hasCDR: hasCDR
            };

            if (hasCDR && currentCDRData) {
                payload.cdrData = {
                    ...currentCDRData,
                    cdrText: formatCDRText(currentCDRData),
                    cdrHTML: formatCDRHTML(currentCDRData)
                };
            }

            const formData = new FormData();
            formData.append('data', JSON.stringify(payload));

            fetch('https://hooks.zapier.com/hooks/catch/19713185/u4w2uc2/', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    statusDiv.style.backgroundColor = '#d4edda';
                    statusDiv.style.color = '#155724';
                    statusDiv.textContent = '✓ Successfully sent to Zapier!';
                    setTimeout(() => statusDiv.style.display = 'none', 3000);
                } else {
                    throw new Error('Failed to send');
                }
            })
            .catch(error => {
                statusDiv.style.backgroundColor = '#f8d7da';
                statusDiv.style.color = '#721c24';
                statusDiv.textContent = '✗ Failed to send to Zapier. Please try again.';
                console.error('Zapier error:', error);
            });
        };

        const sendCDRToZapier = () => sendToZapier(true);

        // Continue with remaining JavaScript functions...
        const loadClientInfo = () => {
            const clientId = parseInt(document.getElementById('clientSelect').value);
            const infoDiv = document.getElementById('clientInfo');
            const letterTypeSelect = document.getElementById('letterType');

            if (!clientId) {
                infoDiv.style.display = 'none';
                letterTypeSelect.disabled = true;
                return;
            }

            const client = clients.find(c => c.id === clientId);
            if (!client) return;

            currentClient = client;
            letterTypeSelect.disabled = false;

            document.getElementById('infoName').textContent = client.name;
            document.getElementById('infoMatterNumber').textContent = client.matterNumber;
            document.getElementById('infoCourt').textContent = client.court;
            document.getElementById('infoCharges').textContent = client.charges;
            document.getElementById('infoNextCourt').textContent = client.nextCourt ? formatDate(client.nextCourt) : 'TBD';

            infoDiv.style.display = 'block';
        };

        const generatePrompt = () => {
            if (!currentClient) {
                alert('Please select a client first');
                return;
            }

            const letterType = document.getElementById('letterType').value;
            const allocateTo = getLetterAllocatedTo();
            const promptOutput = document.getElementById('promptOutput');

            let prompt = '';

            switch(letterType) {
                case 'CCL':
                    prompt = `Generate a compassionate CCL letter for ${currentClient.name}, who is facing charges of ${currentClient.charges}. The matter is scheduled for ${currentClient.nextCourt ? formatDate(currentClient.nextCourt) : 'a date to be determined'} at ${currentClient.court}. Emphasize their sincere apology, commitment to positive change, and any relevant personal circumstances that show their genuine character.`;
                    break;
                case 'Mention':
                    prompt = `Generate a professional mention letter for ${currentClient.name} regarding matter ${currentClient.matterNumber}. The next court appearance is ${currentClient.nextCourt ? formatDate(currentClient.nextCourt) : 'to be determined'} at ${currentClient.court}. Charges: ${currentClient.charges}. Allocated to: ${allocateTo}.`;
                    break;
                case 'Final':
                    prompt = `Generate a comprehensive final letter for ${currentClient.name} summarizing the resolution of matter ${currentClient.matterNumber} at ${currentClient.court}. Include details about the outcome and any necessary follow-up actions.`;
                    break;
                case 'FeeReestimate':
                    prompt = `Generate a fee re-estimate letter for ${currentClient.name} regarding matter ${currentClient.matterNumber}. The case involves ${currentClient.charges} at ${currentClient.court}. Explain the reasons for the fee adjustment and provide a clear breakdown of anticipated costs.`;
                    break;
            }

            promptOutput.textContent = prompt;
            promptOutput.style.display = 'block';
        };

        const copyPrompt = () => {
            const promptText = document.getElementById('promptOutput').textContent;
            if (!promptText) {
                alert('No prompt to copy');
                return;
            }
            navigator.clipboard.writeText(promptText).then(() => {
                alert('Prompt copied to clipboard!');
            });
        };

        const toggleMobileMenu = () => {
            const tabs = document.querySelector('.tabs');
            tabs.classList.toggle('mobile-active');
        };

        const toggleClientCard = (card) => {
            card.classList.toggle('expanded');
        };

        const clearDatabase = () => {
            if (confirm('Are you sure you want to clear all client data? This cannot be undone.')) {
                clients = [];
                saveData();
                updateUI();
                alert('Database cleared successfully');
            }
        };

        const exportToExcel = () => {
            if (clients.length === 0) {
                alert('No data to export');
                return;
            }

            const ws = XLSX.utils.json_to_sheet(clients);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Clients");
            XLSX.writeFile(wb, "legal_clients_export.xlsx");
        };

        const importFromExcel = (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                    clients = jsonData.map((row, index) => ({
                        id: index + 1,
                        name: row.name || row.Name || row.CLIENT || '',
                        address: row.address || row.Address || '',
                        matterNumber: row.matterNumber || row['Matter Number'] || row.MATTER || '',
                        court: row.court || row.Court || row.COURT || '',
                        matterType: row.matterType || row['Matter Type'] || '',
                        charges: row.charges || row.Charges || row.CHARGES || '',
                        legalAid: row.legalAid === true || row.legalAid === 'Yes',
                        nextCourt: row.nextCourt || row['Next Court'] || '',
                        status: row.status || 'Active',
                        ccl: row.ccl === true || row.ccl === 'Yes',
                        mention: row.mention === true || row.mention === 'Yes',
                        final: row.final === true || row.final === 'Yes',
                        letterHistory: []
                    }));

                    saveData();
                    updateUI();
                    alert(`Successfully imported ${clients.length} clients`);
                } catch (error) {
                    alert('Error importing file. Please check the format.');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        };

        const loadFileNoteClient = () => {
            const clientId = parseInt(document.getElementById('fileNoteClientSelect').value);
            if (!clientId) return;

            const client = clients.find(c => c.id === clientId);
            if (!client) return;

            document.getElementById('fileNoteDate').value = getTodayDate();
            document.getElementById('fileNoteTime').value = new Date().toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit' });
        };

        const generateFileNote = () => {
            const clientId = parseInt(document.getElementById('fileNoteClientSelect').value);
            const client = clients.find(c => c.id === clientId);

            if (!client) {
                alert('Please select a client');
                return;
            }

            const date = document.getElementById('fileNoteDate').value;
            const time = document.getElementById('fileNoteTime').value;
            const attendees = document.getElementById('fileNoteAttendees').value;
            const duration = document.getElementById('fileNoteDuration').value;
            const type = document.getElementById('fileNoteType').value;
            const subject = document.getElementById('fileNoteSubject').value;
            const notes = document.getElementById('fileNoteContent').value;

            const fileNote = `FILE NOTE

Client: ${client.name}
Matter Number: ${client.matterNumber}
Date: ${formatDate(date)}
Time: ${time}
Duration: ${duration} minutes
Type: ${type}
Attendees: ${attendees}

Subject: ${subject}

Notes:
${notes}

---
Generated: ${new Date().toLocaleString()}`;

            const output = document.getElementById('fileNoteOutput');
            output.textContent = fileNote;
            output.style.display = 'block';
        };

        const copyFileNote = () => {
            const noteText = document.getElementById('fileNoteOutput').textContent;
            if (!noteText) {
                alert('No file note to copy');
                return;
            }
            navigator.clipboard.writeText(noteText).then(() => {
                alert('File note copied to clipboard!');
            });
        };

        const updateCourtCalendar = () => {
            const calendarDiv = document.getElementById('calendarContainer');
            if (!calendarDiv) return;

            const today = new Date();
            const currentWeek = getWeekNumber(today);
            
            if (!currentWeekNumber) {
                currentWeekNumber = currentWeek;
            }

            const weekStart = getWeekStart(currentWeekNumber);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 4);

            const weekDates = [];
            for (let i = 0; i < 5; i++) {
                const date = new Date(weekStart);
                date.setDate(date.getDate() + i);
                weekDates.push(date);
            }

            const monthNames = ["January", "February", "March", "April", "May", "June", 
                              "July", "August", "September", "October", "November", "December"];

            let html = `
                <div class="calendar-navigation">
                    <button class="btn btn-secondary" onclick="previousWeek()">← Previous Week</button>
                    <button class="btn btn-secondary" onclick="currentWeek()">Current Week</button>
                    <button class="btn btn-secondary" onclick="nextWeek()">Next Week →</button>
                </div>
                <div class="week-header">
                    <h3>Week ${currentWeekNumber} - ${weekStart.getDate()} ${monthNames[weekStart.getMonth()]} to ${weekEnd.getDate()} ${monthNames[weekEnd.getMonth()]} ${weekEnd.getFullYear()}</h3>
                </div>
                <div class="week-grid-container">
            `;

            const dayNames = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            
            weekDates.forEach((date, index) => {
                const dateStr = date.toISOString().split('T')[0];
                const dayClients = clients.filter(c => c.nextCourt === dateStr);
                const isToday = date.toDateString() === today.toDateString();
                
                html += `
                    <div class="day-card ${isToday ? 'today' : ''}">
                        <div class="day-header">
                            <div class="day-name">${dayNames[index]}</div>
                            <div class="day-date">${date.getDate()} ${monthNames[date.getMonth()]}</div>
                        </div>
                        <div class="day-content">
                `;
                
                if (dayClients.length > 0) {
                    dayClients.forEach(client => {
                        html += `
                            <div class="calendar-appointment">
                                <div class="appointment-time">${client.court}</div>
                                <div class="appointment-client">${client.name}</div>
                                <div class="appointment-matter">${client.matterNumber}</div>
                            </div>
                        `;
                    });
                } else {
                    html += '<div class="no-appointments">No court appearances</div>';
                }
                
                html += `
                        </div>
                    </div>
                `;
            });

            html += '</div>';
            calendarDiv.innerHTML = html;
        };

        const getWeekNumber = (date) => {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        };

        const getWeekStart = (weekNum) => {
            const now = new Date();
            const yearStart = new Date(now.getFullYear(), 0, 1);
            const days = (weekNum - 1) * 7;
            const weekStart = new Date(yearStart.setDate(yearStart.getDate() + days));
            
            const dayOfWeek = weekStart.getDay();
            const diff = weekStart.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
            return new Date(weekStart.setDate(diff));
        };

        const previousWeek = () => {
            currentWeekNumber = Math.max(1, currentWeekNumber - 1);
            updateCourtCalendar();
        };

        const nextWeek = () => {
            currentWeekNumber = Math.min(52, currentWeekNumber + 1);
            updateCourtCalendar();
        };

        const currentWeek = () => {
            currentWeekNumber = getWeekNumber(new Date());
            updateCourtCalendar();
        };

        // Initialize on page load
        window.onload = () => {
            loadSavedData();
            updateUI();
            switchTab('database', { target: document.querySelector('.tab') });
        };
    </script>

    <style>
        /* ===== CSS CUSTOM PROPERTIES ===== */
        :root {
            /* Grid System */
            --grid-unit: 8px;
            --spacing-xs: 8px;
            --spacing-sm: 16px;
            --spacing-md: 24px;
            --spacing-lg: 32px;
            --spacing-xl: 48px;
            --spacing-2xl: 64px;

            /* Component Sizing */
            --button-height: 40px;
            --button-height-mobile: 44px;
            --input-height: 48px;
            --card-radius: 12px;
            --card-padding: 24px;
            --tab-height: 48px;

            /* Primary Colors */
            --color-midnight-950: #020617;
            --color-midnight-900: #0f172a;
            --color-midnight-800: #1e293b;
            --color-midnight-700: #334155;
            --color-midnight-600: #475569;
            --color-midnight-500: #64748b;
            
            /* Accent Colors */
            --color-teal-500: #0891b2;
            --color-teal-400: #06b6d4;
            --color-teal-300: #22d3ee;
            --color-purple-600: #764ba2;
            --color-purple-500: #a855f7;
            --color-purple-400: #c084fc;
            
            /* Semantic Colors */
            --color-success: #10b981;
            --color-success-light: #34d399;
            --color-warning: #f59e0b;
            --color-warning-light: #fbbf24;
            --color-danger: #ef4444;
            --color-danger-light: #f87171;
            
            /* Glass Morphism */
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.18);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --glass-blur: blur(12px);
            
            /* Gradients */
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-dark: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --gradient-glow: linear-gradient(135deg, #06b6d4 0%, #a855f7 100%);
            --gradient-header: linear-gradient(135deg, #1e293b 0%, #334155 50%, #1e293b 100%);
            
            /* Typography */
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-serif: 'Crimson Pro', Georgia, serif;
            --font-mono: 'JetBrains Mono', 'Courier New', monospace;
            
            /* Font Sizes - Modular Scale 1.25 */
            --font-size-xs: 0.64rem;
            --font-size-sm: 0.8rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.25rem;
            --font-size-xl: 1.563rem;
            --font-size-2xl: 1.953rem;
            --font-size-3xl: 2.441rem;
            --font-size-4xl: 3.052rem;
            
            /* Line Heights */
            --line-height-tight: 1.25;
            --line-height-normal: 1.5;
            --line-height-relaxed: 1.75;
            
            /* Transitions */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-glow: 0 0 40px rgba(168, 85, 247, 0.3);
            
            /* Breakpoints */
            --breakpoint-sm: 640px;
            --breakpoint-md: 768px;
            --breakpoint-lg: 1024px;
            --breakpoint-xl: 1280px;
            --breakpoint-2xl: 1536px;
        }

        /* ===== GLOBAL STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            font-size: var(--font-size-base);
            line-height: var(--line-height-normal);
            color: var(--color-midnight-50);
            background: var(--gradient-dark);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 50%, rgba(6, 182, 212, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(168, 85, 247, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-md);
            position: relative;
            z-index: 1;
        }

        /* ===== HEADER COMPONENT ===== */
        .header {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            color: white;
            padding: var(--spacing-lg);
            border-radius: var(--card-radius);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--glass-shadow);
            position: relative;
            overflow: hidden;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--gradient-glow);
            border-radius: var(--card-radius);
            opacity: 0.5;
            z-index: -1;
            animation: borderGlow 3s ease-in-out infinite;
        }

        @keyframes borderGlow {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }

        .header h1 {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin: 0;
            background: linear-gradient(135deg, #fff 0%, #e0e7ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: var(--font-size-sm);
            opacity: 0.9;
            margin: var(--spacing-xs) 0 0 0;
        }

        .mobile-menu-toggle {
            display: none;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: var(--spacing-xs);
        }

        .mobile-menu-toggle span {
            display: block;
            width: 24px;
            height: 2px;
            background: white;
            margin: 5px 0;
            transition: var(--transition-base);
        }

        /* ===== NAVIGATION TABS ===== */
        .tabs {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-md);
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 6px;
            box-shadow: var(--shadow-md);
            overflow-x: auto;
            position: relative;
        }

        .tab {
            padding: 12px var(--spacing-md);
            background: transparent;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: var(--font-size-sm);
            letter-spacing: 0.025em;
            transition: var(--transition-base);
            color: rgba(255, 255, 255, 0.7);
            white-space: nowrap;
            position: relative;
            height: var(--tab-height);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateY(-1px);
        }

        .tab.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.3);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 2px;
            background: var(--gradient-glow);
            border-radius: 2px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { width: 0; opacity: 0; }
            to { width: 40px; opacity: 1; }
        }

        /* ===== TAB CONTENT ===== */
        .tab-content {
            display: none;
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius);
            padding: var(--card-padding);
            box-shadow: var(--glass-shadow);
            animation: fadeIn 0.3s ease-out;
            min-height: 400px;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== CARD COMPONENTS ===== */
        .card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius);
            padding: var(--card-padding);
            margin-bottom: var(--spacing-sm);
            transition: var(--transition-base);
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl), var(--shadow-glow);
            border-color: rgba(168, 85, 247, 0.3);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .card:hover::before {
            left: 100%;
        }

        /* ===== FORM ELEMENTS ===== */
        .form-group {
            margin-bottom: var(--spacing-md);
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            height: var(--input-height);
            padding: 0 var(--spacing-sm);
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: var(--font-size-base);
            transition: var(--transition-base);
            font-family: var(--font-sans);
        }

        .form-group textarea {
            min-height: 120px;
            padding: var(--spacing-sm);
            resize: vertical;
            height: auto;
        }

        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--color-purple-400);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.2);
        }

        .form-group select option {
            background: var(--color-midnight-800);
            color: white;
        }

        /* ===== BUTTONS ===== */
        .btn {
            height: var(--button-height);
            padding: 0 var(--spacing-md);
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: var(--font-size-sm);
            letter-spacing: 0.025em;
            cursor: pointer;
            transition: var(--transition-base);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 20px rgba(168, 85, 247, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0) scale(0.98);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.1);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--color-success) 0%, var(--color-success-light) 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
        }

        /* ===== DATA TABLES ===== */
        .master-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: var(--spacing-md);
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--card-radius);
            overflow: hidden;
        }

        .master-table th {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: var(--glass-blur);
            padding: var(--spacing-sm);
            text-align: left;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            font-size: var(--font-size-sm);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            height: 56px;
        }

        .master-table td {
            padding: var(--spacing-sm);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.8);
            min-height: 56px;
        }

        .master-table tr {
            transition: var(--transition-fast);
        }

        .master-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .master-table tbody tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.02);
        }

        /* ===== STATUS BADGES ===== */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: var(--font-size-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-active {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(52, 211, 153, 0.2) 100%);
            color: var(--color-success-light);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-waiting {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(251, 191, 36, 0.2) 100%);
            color: var(--color-warning-light);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-completed {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
            color: #a78bfa;
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        /* ===== DATABASE STATUS ===== */
        .database-status {
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            font-size: var(--font-size-sm);
            letter-spacing: 0.025em;
            transition: var(--transition-base);
        }

        .status-connected {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(52, 211, 153, 0.2) 100%);
            color: var(--color-success-light);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-disconnected {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(248, 113, 113, 0.2) 100%);
            color: var(--color-danger-light);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* ===== CLIENT INFO DISPLAY ===== */
        .client-info {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: var(--card-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            backdrop-filter: var(--glass-blur);
        }

        .client-info h3 {
            margin: 0 0 var(--spacing-sm) 0;
            color: var(--color-teal-300);
            font-size: var(--font-size-lg);
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-sm);
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .info-label {
            font-size: var(--font-size-xs);
            font-weight: 600;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .info-value {
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
            font-size: var(--font-size-base);
        }

        /* ===== OUTPUT BOXES ===== */
        .output-box {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: var(--spacing-md);
            margin-top: var(--spacing-md);
            font-family: var(--font-mono);
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            color: rgba(255, 255, 255, 0.9);
            font-size: var(--font-size-sm);
            line-height: var(--line-height-relaxed);
        }

        .output-box::-webkit-scrollbar {
            width: 8px;
        }

        .output-box::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .output-box::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .output-box::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ===== CHECKBOX GROUP ===== */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-sm);
            margin-top: var(--spacing-sm);
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            padding: var(--spacing-sm);
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: var(--transition-base);
            cursor: pointer;
            min-height: 44px;
        }

        .checkbox-item:hover {
            border-color: var(--color-purple-400);
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .checkbox-item input[type="checkbox"],
        .checkbox-item input[type="radio"] {
            width: 20px;
            height: 20px;
            accent-color: var(--color-purple-500);
            cursor: pointer;
        }

        .checkbox-item label {
            cursor: pointer;
            color: rgba(255, 255, 255, 0.9);
            font-size: var(--font-size-sm);
        }

        /* ===== MODAL ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius);
            padding: var(--spacing-lg);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease-out forwards;
            box-shadow: var(--shadow-xl);
        }

        @keyframes modalSlideIn {
            to {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .modal-content h2 {
            color: white;
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-xl);
        }

        .close {
            position: absolute;
            top: var(--spacing-sm);
            right: var(--spacing-md);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.6);
            transition: var(--transition-fast);
            background: none;
            border: none;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close:hover {
            color: white;
            transform: rotate(90deg);
        }

        /* ===== FLOATING ACTION BUTTON ===== */
        .add-client-btn {
            position: fixed;
            bottom: var(--spacing-lg);
            right: var(--spacing-lg);
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-primary);
            color: white;
            border: none;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);
            transition: var(--transition-base);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .add-client-btn:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 8px 24px rgba(168, 85, 247, 0.6);
        }

        .add-client-btn:active {
            transform: scale(0.95);
        }

        /* ===== CLIENT CARDS (Mobile) ===== */
        .client-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius);
            padding: var(--spacing-sm);
            margin-bottom: var(--spacing-sm);
            transition: var(--transition-base);
            cursor: pointer;
        }

        .client-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(168, 85, 247, 0.3);
        }

        .client-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .client-card-name {
            font-weight: 600;
            color: white;
            font-size: var(--font-size-base);
            margin-bottom: 4px;
        }

        .client-card-matter {
            color: rgba(255, 255, 255, 0.6);
            font-size: var(--font-size-sm);
        }

        .client-card-expand {
            color: rgba(255, 255, 255, 0.6);
            transition: var(--transition-fast);
        }

        .client-card.expanded .client-card-expand {
            transform: rotate(180deg);
        }

        .client-card-details {
            display: none;
            margin-top: var(--spacing-sm);
            padding-top: var(--spacing-sm);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .client-card.expanded .client-card-details {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        .client-card-row {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-xs) 0;
        }

        .client-card-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: var(--font-size-sm);
        }

        .client-card-value {
            color: white;
            font-weight: 500;
            font-size: var(--font-size-sm);
        }

        .client-card-btn {
            width: 100%;
            margin-top: var(--spacing-sm);
            padding: var(--spacing-sm);
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-base);
        }

        .client-card-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);
        }

        /* ===== ANALYTICS CARDS ===== */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
        }

        .analytics-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius);
            padding: var(--card-padding);
            transition: var(--transition-base);
            position: relative;
            overflow: hidden;
        }

        .analytics-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .analytics-card h3 {
            color: rgba(255, 255, 255, 0.7);
            font-size: var(--font-size-sm);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--spacing-xs);
        }

        .analytics-value {
            font-size: var(--font-size-3xl);
            font-weight: 700;
            background: var(--gradient-glow);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ===== COURT BREAKDOWN ===== */
        .court-breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition-fast);
        }

        .court-breakdown-item:hover {
            padding-left: var(--spacing-xs);
            background: rgba(255, 255, 255, 0.05);
        }

        .court-name {
            color: rgba(255, 255, 255, 0.8);
        }

        .court-count {
            font-weight: 600;
            color: var(--color-purple-400);
        }

        /* ===== LETTER STATUS GRID ===== */
        .letter-status-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-md);
        }

        .status-card {
            text-align: center;
            padding: var(--spacing-md);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            transition: var(--transition-base);
        }

        .status-card:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.08);
        }

        .status-number {
            font-size: var(--font-size-2xl);
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }

        .status-card:nth-child(1) .status-number {
            color: var(--color-teal-400);
        }

        .status-card:nth-child(2) .status-number {
            color: var(--color-success-light);
        }

        .status-card:nth-child(3) .status-number {
            color: var(--color-danger-light);
        }

        .status-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: var(--font-size-sm);
        }

        /* ===== CALENDAR STYLES ===== */
        .calendar-navigation {
            display: flex;
            gap: var(--spacing-sm);
            margin: var(--spacing-md) 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .week-header {
            text-align: center;
            margin: var(--spacing-md) 0;
            color: white;
        }

        .week-header h3 {
            font-size: var(--font-size-xl);
            margin: 0;
        }

        .week-grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-sm);
            margin: var(--spacing-lg) 0;
        }

        .day-card {
            background: var(--glass-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--glass-border);
            border-radius: var(--card-radius);
            padding: var(--spacing-sm);
            min-height: 200px;
            transition: var(--transition-base);
        }

        .day-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: rgba(168, 85, 247, 0.3);
        }

        .day-card.today {
            border-color: var(--color-purple-400);
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(6, 182, 212, 0.1) 100%);
        }

        .day-header {
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: var(--spacing-sm);
        }

        .day-name {
            font-weight: 600;
            color: white;
            font-size: var(--font-size-base);
        }

        .day-date {
            color: rgba(255, 255, 255, 0.6);
            font-size: var(--font-size-sm);
        }

        .calendar-appointment {
            padding: var(--spacing-xs);
            margin-bottom: var(--spacing-xs);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border-left: 3px solid var(--color-purple-400);
            transition: var(--transition-fast);
        }

        .calendar-appointment:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(4px);
        }

        .appointment-time {
            font-size: var(--font-size-xs);
            color: var(--color-purple-400);
            font-weight: 600;
        }

        .appointment-client {
            font-size: var(--font-size-sm);
            color: white;
            font-weight: 500;
        }

        .appointment-matter {
            font-size: var(--font-size-xs);
            color: rgba(255, 255, 255, 0.6);
        }

        .no-appointments {
            text-align: center;
            color: rgba(255, 255, 255, 0.4);
            font-size: var(--font-size-sm);
            padding: var(--spacing-md);
        }

        .no-data {
            color: rgba(255, 255, 255, 0.4);
            text-align: center;
            padding: var(--spacing-lg);
        }

        /* ===== CDR CHECKBOX ===== */
        .cdr-checkbox {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(251, 191, 36, 0.1) 100%);
            border: 2px solid rgba(245, 158, 11, 0.3);
            border-radius: var(--card-radius);
            padding: var(--spacing-md);
            margin-top: var(--spacing-md);
            transition: var(--transition-base);
        }

        .cdr-checkbox:hover {
            border-color: rgba(245, 158, 11, 0.5);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.15) 0%, rgba(251, 191, 36, 0.15) 100%);
        }

        .cdr-checkbox label {
            font-weight: 600;
            color: var(--color-warning-light);
            cursor: pointer;
        }

        /* ===== SECTION HEADERS ===== */
        .section {
            border-top: 2px solid rgba(255, 255, 255, 0.1);
            margin-top: var(--spacing-lg);
            padding-top: var(--spacing-md);
        }

        .section-title {
            font-size: var(--font-size-lg);
            font-weight: 700;
            background: var(--gradient-glow);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--spacing-md);
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            :root {
                --font-size-base: 14px;
            }

            body {
                padding: var(--spacing-sm);
            }

            .container {
                padding: var(--spacing-sm);
            }

            .header {
                height: 64px;
                padding: var(--spacing-sm);
            }

            .header h1 {
                font-size: var(--font-size-lg);
            }

            .header p {
                display: none;
            }

            .mobile-menu-toggle {
                display: block;
            }

            .tabs {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                border-radius: 24px 24px 0 0;
                padding: var(--spacing-sm);
                z-index: 100;
                transform: translateY(100%);
                transition: var(--transition-base);
            }

            .tabs.mobile-active {
                transform: translateY(0);
            }

            .tab {
                font-size: var(--font-size-xs);
                padding: var(--spacing-xs) var(--spacing-sm);
                height: var(--button-height-mobile);
            }

            .tab-content {
                padding: var(--spacing-sm);
                margin-bottom: 80px;
            }

            .master-table {
                display: none;
            }

            .analytics-grid {
                grid-template-columns: 1fr;
            }

            .week-grid-container {
                grid-template-columns: 1fr;
            }

            .form-group select,
            .form-group input,
            .form-group textarea {
                font-size: 16px;
            }

            .btn {
                height: var(--button-height-mobile);
            }

            .add-client-btn {
                bottom: 80px;
            }

            .modal-content {
                width: 95%;
                padding: var(--spacing-sm);
            }
        }

        @media (min-width: 1024px) {
            .client-card {
                display: none;
            }
        }

        /* ===== LOADING STATES ===== */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        /* ===== PRINT STYLES ===== */
        @media print {
            body {
                background: white;
                color: black;
            }

            .header,
            .tabs,
            .add-client-btn,
            .btn {
                display: none;
            }

            .tab-content {
                display: block !important;
                background: white;
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }

        /* ===== ACCESSIBILITY ===== */
        *:focus-visible {
            outline: 2px solid var(--color-purple-400);
            outline-offset: 2px;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* ===== UTILITY CLASSES ===== */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .font-bold { font-weight: 700; }
        .mt-sm { margin-top: var(--spacing-sm); }
        .mt-md { margin-top: var(--spacing-md); }
        .mt-lg { margin-top: var(--spacing-lg); }
        .mb-sm { margin-bottom: var(--spacing-sm); }
        .mb-md { margin-bottom: var(--spacing-md); }
        .mb-lg { margin-bottom: var(--spacing-lg); }
        .p-sm { padding: var(--spacing-sm); }
        .p-md { padding: var(--spacing-md); }
        .p-lg { padding: var(--spacing-lg); }
        .gap-sm { gap: var(--spacing-sm); }
        .gap-md { gap: var(--spacing-md); }
        .gap-lg { gap: var(--spacing-lg); }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>Legal Letter Generation System</h1>
                <p>Streamlined client matter management and automated Claude prompt generation</p>
            </div>
            <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('database', event)">Database</button>
            <button class="tab" onclick="switchTab('letterGeneration', event)">Letter Generation</button>
            <button class="tab" onclick="switchTab('cdr', event)">CDR</button>
            <button class="tab" onclick="switchTab('fileNote', event)">File Notes</button>
            <button class="tab" onclick="switchTab('analytics', event)">Analytics</button>
            <button class="tab" onclick="switchTab('calendar', event)">Calendar</button>
            <button class="tab" onclick="switchTab('settings', event)">Settings</button>
        </div>

        <!-- Database Tab -->
        <div id="database" class="tab-content active">
            <div class="database-status status-disconnected" id="databaseStatus">
                Database: Not Connected
            </div>

            <div class="mb-md">
                <input type="file" id="excelUpload" accept=".xlsx,.xls" onchange="importFromExcel(event)" style="display: none;">
                <button class="btn btn-primary" onclick="document.getElementById('excelUpload').click()">
                    Upload Excel Database
                </button>
                <button class="btn btn-secondary" onclick="exportToExcel()">Export to Excel</button>
                <button class="btn btn-secondary" onclick="clearDatabase()">Clear Database</button>
            </div>

            <table class="master-table">
                <thead>
                    <tr>
                        <th>Client Name</th>
                        <th>Matter #</th>
                        <th>Court</th>
                        <th>Charges</th>
                        <th>Status</th>
                        <th>CCL</th>
                        <th>Mention</th>
                        <th>Final</th>
                        <th>Next Court</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="clientTableBody">
                    <tr>
                        <td colspan="10" style="text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
                            No clients loaded. Please upload an Excel database or add clients manually.
                        </td>
                    </tr>
                </tbody>
            </table>

            <div id="clientCardsContainer"></div>
        </div>

        <!-- Letter Generation Tab -->
        <div id="letterGeneration" class="tab-content">
            <div class="form-group">
                <label for="clientSelect">Select Client</label>
                <select id="clientSelect" onchange="loadClientInfo()">
                    <option value="">-- Select a Client --</option>
                </select>
            </div>

            <div id="clientInfo" class="client-info" style="display: none;">
                <h3>Client Information</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Name</span>
                        <span class="info-value" id="infoName"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Matter Number</span>
                        <span class="info-value" id="infoMatterNumber"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Court</span>
                        <span class="info-value" id="infoCourt"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Charges</span>
                        <span class="info-value" id="infoCharges"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Next Court Date</span>
                        <span class="info-value" id="infoNextCourt"></span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="letterType">Letter Type</label>
                <select id="letterType" disabled>
                    <option value="">-- Select Letter Type --</option>
                    <option value="CCL">Character & Credit Letter (CCL)</option>
                    <option value="Mention">Mention Letter</option>
                    <option value="Final">Final Letter</option>
                    <option value="FeeReestimate">Fee Re-estimate</option>
                </select>
            </div>

            <div class="form-group">
                <label for="clientPrefix">Client Prefix (Optional)</label>
                <select id="clientPrefix">
                    <option value="">None</option>
                    <option value="Mr">Mr</option>
                    <option value="Mrs">Mrs</option>
                    <option value="Ms">Ms</option>
                    <option value="Dr">Dr</option>
                </select>
            </div>

            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="letter_allocate_AG" value="AG">
                    <label for="letter_allocate_AG">Allocate to AG</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="letter_allocate_SC" value="SC">
                    <label for="letter_allocate_SC">Allocate to SC</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="letter_allocate_LL" value="LL">
                    <label for="letter_allocate_LL">Allocate to LL</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="letter_allocate_BX" value="BX">
                    <label for="letter_allocate_BX">Allocate to BX</label>
                </div>
            </div>

            <div class="cdr-checkbox">
                <input type="checkbox" id="generateCDRWithLetter">
                <label for="generateCDRWithLetter">Generate CDR with this letter</label>
            </div>

            <div class="mt-md">
                <button class="btn btn-primary" onclick="generatePrompt()">Generate Prompt</button>
                <button class="btn btn-secondary" onclick="copyPrompt()">Copy Prompt</button>
                <button class="btn btn-success" onclick="sendToZapier()">Send to Zapier</button>
            </div>

            <div id="promptOutput" class="output-box" style="display: none;"></div>
            <div id="zapierStatus" style="display: none; padding: 10px; margin-top: 10px; border-radius: 4px;"></div>
        </div>

        <!-- CDR Tab -->
        <div id="cdr" class="tab-content">
            <div class="form-group">
                <label for="cdrClientSelect">Select Client (Optional)</label>
                <select id="cdrClientSelect" onchange="loadCDRClientInfo()">
                    <option value="">-- Manual Entry --</option>
                </select>
            </div>

            <div class="section">
                <h3 class="section-title">Court Outcome</h3>
                <div class="form-group">
                    <label for="cdrOutcomeCourt">Court</label>
                    <input type="text" id="cdrOutcomeCourt" placeholder="e.g., Southport Magistrates Court">
                </div>
                <div class="form-group">
                    <label for="cdrOutcomeDate">Date</label>
                    <input type="date" id="cdrOutcomeDate">
                </div>
                <div class="form-group">
                    <label for="cdrStartTime">Start Time</label>
                    <input type="time" id="cdrStartTime">
                </div>
                <div class="form-group">
                    <label for="cdrFinishTime">Finish Time</label>
                    <input type="time" id="cdrFinishTime">
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">Court Diary Request</h3>
                <div class="form-group">
                    <label for="cdrCourtDate">Court Date</label>
                    <input type="date" id="cdrCourtDate">
                </div>
                <div class="form-group">
                    <label for="cdrSolicitor">Solicitor</label>
                    <input type="text" id="cdrSolicitor" placeholder="Solicitor name">
                </div>
                <div class="form-group">
                    <label for="cdrClientName">Client Name</label>
                    <input type="text" id="cdrClientName" placeholder="Client full name">
                </div>
                <div class="form-group">
                    <label for="cdrFileNumber">File Number</label>
                    <input type="text" id="cdrFileNumber" placeholder="e.g., MAG123456">
                </div>
                <div class="form-group">
                    <label for="cdrReason">Reason</label>
                    <select id="cdrReason">
                        <option value="Mention">Mention</option>
                        <option value="Sentence">Sentence</option>
                        <option value="Hearing">Hearing</option>
                        <option value="Trial">Trial</option>
                        <option value="Review">Review</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="cdrCourt">Court</label>
                    <input type="text" id="cdrCourt" placeholder="e.g., Southport Magistrates Court">
                </div>
                <div class="form-group">
                    <label for="cdrCourtTime">Court Time</label>
                    <input type="time" id="cdrCourtTime">
                </div>

                <div class="form-group">
                    <label>Allocate To</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="allocate_AG" value="AG">
                            <label for="allocate_AG">AG</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allocate_SC" value="SC">
                            <label for="allocate_SC">SC</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allocate_LL" value="LL">
                            <label for="allocate_LL">LL</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="allocate_BX" value="BX">
                            <label for="allocate_BX">BX</label>
                        </div>
                    </div>
                </div>

                <div class="checkbox-item">
                    <input type="checkbox" id="cdrClientExcused">
                    <label for="cdrClientExcused">Client Excused</label>
                </div>

                <div class="form-group">
                    <label for="cdrFeeReminder">Fee Reminder</label>
                    <select id="cdrFeeReminder">
                        <option value="">None</option>
                        <option value="Quote Required">Quote Required</option>
                        <option value="Payment Due">Payment Due</option>
                        <option value="Trust Low">Trust Low</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="cdrAdditionalDates">Additional Dates (Optional)</label>
                    <textarea id="cdrAdditionalDates" placeholder="Enter any additional court dates or important dates"></textarea>
                </div>
            </div>

            <div class="mt-md">
                <button class="btn btn-primary" onclick="generateCDR()">Generate CDR</button>
                <button class="btn btn-success" onclick="sendCDRToZapier()">Send CDR to Zapier</button>
            </div>

            <div id="cdrOutput" class="output-box" style="display: none;"></div>
            <div id="cdrZapierStatus" style="display: none; padding: 10px; margin-top: 10px; border-radius: 4px;"></div>
        </div>

        <!-- File Notes Tab -->
        <div id="fileNote" class="tab-content">
            <div class="form-group">
                <label for="fileNoteClientSelect">Select Client</label>
                <select id="fileNoteClientSelect" onchange="loadFileNoteClient()">
                    <option value="">-- Select a Client --</option>
                </select>
            </div>

            <div class="form-group">
                <label for="fileNoteDate">Date</label>
                <input type="date" id="fileNoteDate">
            </div>

            <div class="form-group">
                <label for="fileNoteTime">Time</label>
                <input type="time" id="fileNoteTime">
            </div>

            <div class="form-group">
                <label for="fileNoteType">Type</label>
                <select id="fileNoteType">
                    <option value="Phone Call">Phone Call</option>
                    <option value="Meeting">Meeting</option>
                    <option value="Email">Email</option>
                    <option value="Court Attendance">Court Attendance</option>
                    <option value="Research">Research</option>
                    <option value="Document Preparation">Document Preparation</option>
                </select>
            </div>

            <div class="form-group">
                <label for="fileNoteAttendees">Attendees/Participants</label>
                <input type="text" id="fileNoteAttendees" placeholder="e.g., Client, Prosecutor, Magistrate">
            </div>

            <div class="form-group">
                <label for="fileNoteDuration">Duration (minutes)</label>
                <input type="number" id="fileNoteDuration" placeholder="30">
            </div>

            <div class="form-group">
                <label for="fileNoteSubject">Subject</label>
                <input type="text" id="fileNoteSubject" placeholder="Brief subject of the note">
            </div>

            <div class="form-group">
                <label for="fileNoteContent">Notes</label>
                <textarea id="fileNoteContent" rows="8" placeholder="Detailed notes of the interaction..."></textarea>
            </div>

            <div class="mt-md">
                <button class="btn btn-primary" onclick="generateFileNote()">Generate File Note</button>
                <button class="btn btn-secondary" onclick="copyFileNote()">Copy File Note</button>
            </div>

            <div id="fileNoteOutput" class="output-box" style="display: none;"></div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <div class="analytics-grid">
                <div class="analytics-card">
                    <h3>Total Matters</h3>
                    <div class="analytics-value" id="totalMatters">0</div>
                </div>
                <div class="analytics-card">
                    <h3>Active Matters</h3>
                    <div class="analytics-value" id="activeMatters">0</div>
                </div>
                <div class="analytics-card">
                    <h3>Pending Letters</h3>
                    <div class="analytics-value" id="pendingLetters">0</div>
                </div>
                <div class="analytics-card">
                    <h3>Upcoming Court</h3>
                    <div class="analytics-value" id="upcomingCourt">0</div>
                </div>
            </div>

            <div class="card">
                <h3 class="section-title">Court Breakdown</h3>
                <div id="courtBreakdown"></div>
            </div>

            <div class="card mt-md">
                <h3 class="section-title">Letter Status</h3>
                <div id="letterStatusChart"></div>
            </div>
        </div>

        <!-- Calendar Tab -->
        <div id="calendar" class="tab-content">
            <div id="calendarContainer"></div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <h3 class="section-title">System Settings</h3>
            <div class="card">
                <p>Version: 2.0.0</p>
                <p>Last Updated: ${new Date().toLocaleDateString()}</p>
                <div class="mt-md">
                    <button class="btn btn-secondary" onclick="exportToExcel()">Export Database</button>
                    <button class="btn btn-secondary" onclick="clearDatabase()">Clear All Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Client Modal -->
    <div id="addClientModal" class="modal">
        <div class="modal-content">
            <button class="close" onclick="closeModal()">&times;</button>
            <h2>Add New Client</h2>
            <form id="addClientForm" onsubmit="addClient(event)">
                <div class="form-group">
                    <label for="newClientName">Client Name *</label>
                    <input type="text" id="newClientName" required>
                </div>
                <div class="form-group">
                    <label for="newClientAddress">Address</label>
                    <textarea id="newClientAddress" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="newMatterNumber">Matter Number *</label>
                    <input type="text" id="newMatterNumber" required>
                </div>
                <div class="form-group">
                    <label for="newCourt">Court *</label>
                    <select id="newCourt" required>
                        <option value="">-- Select Court --</option>
                        <option value="Southport Magistrates Court">Southport Magistrates Court</option>
                        <option value="Brisbane Magistrates Court">Brisbane Magistrates Court</option>
                        <option value="Beenleigh Magistrates Court">Beenleigh Magistrates Court</option>
                        <option value="Cleveland Magistrates Court">Cleveland Magistrates Court</option>
                        <option value="Pine Rivers Magistrates Court">Pine Rivers Magistrates Court</option>
                        <option value="Richlands Magistrates Court">Richlands Magistrates Court</option>
                        <option value="Ipswich Magistrates Court">Ipswich Magistrates Court</option>
                        <option value="District Court">District Court</option>
                        <option value="Supreme Court">Supreme Court</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newMatterType">Matter Type</label>
                    <select id="newMatterType">
                        <option value="Criminal">Criminal</option>
                        <option value="Traffic">Traffic</option>
                        <option value="DV">Domestic Violence</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newCharges">Charges</label>
                    <textarea id="newCharges" rows="3" placeholder="List all charges"></textarea>
                </div>
                <div class="form-group">
                    <label for="newLegalAid">Legal Aid</label>
                    <select id="newLegalAid">
                        <option value="No">No</option>
                        <option value="Yes">Yes</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="newNextCourt">Next Court Date</label>
                    <input type="date" id="newNextCourt">
                </div>
                <div class="mt-md">
                    <button type="submit" class="btn btn-primary">Add Client</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <button class="add-client-btn" onclick="openModal()">+</button>
</body>
</html>
